from add_landmarks import *

def TestGetClosestPoint():
    # Clockwise square
    face_points = [Point(0,0), Point(0,1), Point(1,1), Point(1,0)]
    gaze_point = Point(2,2)
    closest_point = GetClosestPoint(gaze_point, face_points)
    assert(closest_point == Point(1,1))
    print("Passed Get Closest Point")

def TestGetClosestFeature():
    face_points = [[[534, 164], [541, 144], [537, 151], [538, 126], [542, 138], [542, 131], [542, 116], [499, 109], [543, 102], [544, 94], [547, 64], [533, 165], [533, 167], [533, 168], [533, 168], [533, 170], [533, 172], [532, 174], [531, 183], [540, 147], [534, 147], [475, 82], [514, 116], [508, 116], [503, 114], [496, 110], [519, 115], [509, 98], [515, 99], [503, 98], [499, 99], [490, 113], [510, 192], [497, 107], [470, 109], [484, 107], [510, 138], [528, 162], [528, 166], [522, 163], [518, 164], [523, 166], [519, 166], [508, 172], [537, 143], [537, 138], [492, 91], [522, 126], [523, 141], [522, 138], [491, 135], [538, 131], [508, 86], [499, 87], [484, 72], [532, 96], [520, 103], [504, 167], [464, 168], [526, 145], [530, 147], [512, 167], [513, 167], [496, 83], [521, 144], [518, 88], [519, 83], [514, 60], [491, 78], [518, 73], [488, 88], [482, 87], [528, 164], [523, 164], [518, 165], [527, 146], [512, 167], [515, 168], [514, 167], [530, 143], [519, 167], [523, 167], [528, 167], [525, 182], [527, 173], [528, 171], [528, 169], [528, 167], [520, 167], [519, 167], [518, 168], [518, 170], [513, 158], [461, 138], [538, 149], [516, 167], [516, 167], [531, 150], [522, 147], [531, 149], [516, 128], [506, 130], [520, 141], [497, 64], [503, 73], [506, 81], [512, 176], [532, 87], [531, 75], [530, 61], [498, 112], [484, 115], [522, 114], [492, 101], [527, 123], [527, 139], [477, 120], [487, 120], [494, 123], [505, 124], [514, 123], [520, 121], [536, 116], [476, 133], [488, 99], [537, 147], [523, 131], [464, 109], [525, 119], [519, 142], [494, 106], [527, 136], [461, 153], [522, 112], [532, 133], [482, 180], [479, 188], [466, 135], [474, 172], [476, 97], [507, 197], [537, 149], [517, 135], [479, 107], [504, 111], [509, 112], [514, 169], [475, 145], [516, 205], [498, 199], [489, 195], [546, 78], [526, 207], [514, 113], [518, 112], [521, 112], [483, 97], [518, 109], [513, 108], [509, 107], [504, 107], [501, 107], [469, 94], [501, 110], [537, 155], [519, 155], [526, 144], [530, 154], [541, 109], [491, 187], [499, 192], [517, 201], [471, 180], [521, 111], [532, 124], [528, 202], [507, 203], [466, 149], [524, 167], [523, 168], [523, 169], [522, 172], [518, 179], [516, 167], [515, 166], [514, 166], [507, 162], [484, 148], [532, 119], [528, 107], [524, 108], [516, 167], [480, 163], [534, 107], [513, 186], [542, 126], [537, 121], [542, 121], [528, 132], [529, 197], [530, 190], [522, 189], [501, 175], [513, 146], [507, 181], [500, 143], [507, 150], [492, 152], [519, 195], [523, 135], [495, 180], [502, 186], [498, 168], [474, 156], [488, 169], [468, 161], [501, 157], [528, 127], [528, 142], [524, 143], [532, 138], [525, 101], [517, 95], [509, 93], [502, 93], [496, 96], [490, 107], [468, 122], [493, 115], [499, 118], [506, 119], [514, 119], [520, 118], [524, 117], [462, 124], [524, 145], [533, 128], [533, 142], [534, 146], [532, 144], [524, 147], [536, 146], [535, 148], [524, 112], [528, 114], [530, 115], [499, 107], [495, 102], [546, 128], [571, 126], [542, 149], [587, 106], [557, 126], [561, 128], [566, 128], [572, 128], [554, 123], [567, 111], [562, 111], [572, 113], [574, 116], [574, 131], [544, 196], [573, 126], [584, 132], [579, 127], [559, 147], [539, 164], [537, 168], [543, 167], [545, 170], [541, 170], [543, 171], [550, 179], [545, 145], [546, 139], [582, 110], [551, 132], [552, 146], [552, 144], [572, 150], [546, 133], [574, 100], [579, 104], [587, 94], [553, 101], [557, 112], [554, 175], [566, 185], [547, 149], [543, 150], [548, 175], [547, 174], [582, 101], [550, 149], [566, 99], [568, 94], [573, 74], [584, 98], [570, 84], [584, 108], [586, 109], [538, 166], [542, 169], [544, 171], [546, 150], [547, 175], [545, 174], [546, 174], [547, 147], [542, 172], [540, 170], [536, 169], [536, 184], [537, 175], [537, 173], [537, 171], [537, 169], [542, 172], [543, 173], [544, 174], [544, 176], [552, 165], [574, 159], [544, 173], [545, 174], [542, 152], [548, 152], [543, 151], [556, 136], [563, 141], [552, 147], [582, 83], [579, 90], [577, 96], [546, 181], [557, 93], [559, 81], [562, 68], [570, 129], [578, 134], [552, 121], [578, 119], [549, 127], [551, 144], [582, 141], [575, 138], [570, 138], [561, 136], [556, 132], [551, 128], [545, 118], [580, 152], [581, 118], [542, 148], [551, 136], [581, 133], [549, 124], [551, 147], [575, 125], [551, 140], [570, 172], [552, 120], [549, 136], [561, 192], [557, 200], [579, 156], [567, 188], [585, 119], [544, 202], [540, 149], [554, 141], [582, 128], [566, 126], [562, 125], [546, 175], [577, 164], [534, 207], [546, 205], [551, 203], [558, 123], [555, 121], [553, 120], [583, 117], [556, 120], [559, 122], [563, 123], [567, 124], [569, 125], [585, 118], [569, 126], [549, 160], [548, 148], [542, 156], [555, 196], [549, 199], [537, 203], [562, 194], [553, 120], [548, 127], [541, 206], [576, 169], [540, 170], [540, 172], [541, 173], [541, 176], [542, 183], [545, 173], [546, 173], [547, 173], [554, 170], [573, 164], [547, 122], [550, 113], [552, 115], [544, 173], [569, 178], [547, 111], [543, 190], [546, 123], [549, 136], [537, 191], [553, 183], [554, 153], [548, 187], [565, 155], [558, 160], [567, 166], [537, 198], [551, 140], [556, 189], [550, 193], [558, 178], [573, 173], [563, 181], [572, 179], [560, 168], [549, 132], [549, 146], [550, 148], [549, 141], [555, 108], [564, 106], [570, 107], [575, 109], [578, 113], [577, 126], [582, 144], [572, 132], [567, 133], [562, 131], [556, 129], [552, 125], [550, 123], [577, 146], [549, 149], [548, 131], [547, 145], [543, 148], [546, 146], [547, 151], [543, 148], [541, 149], [551, 119], [548, 119], [547, 119], [571, 125], [576, 120], [512, 111], [516, 111], [512, 106], [507, 110], [511, 115], [562, 122], [567, 124], [563, 118], [557, 121], [561, 127]]]
    face_points = list(map(lambda p_xy: Point(p_xy[0], -p_xy[1]), face_points[0]))
    # We use our perspective eg. Right Eye is right from our perspective, person's left    
    
    gaze_left_eye = Point(500,-100)
    closest_feature, on_feature, min_feature_dist = GetClosestFeature(gaze_left_eye, face_points)
    print(closest_feature, on_feature, min_feature_dist)
    assert(closest_feature == "left_eye" and
           on_feature      == "left_eye" and
           min_feature_dist== 0)
    
    gaze_right_eye = Point(560,-100)
    closest_feature, on_feature, min_feature_dist = GetClosestFeature(gaze_right_eye, face_points)
    print(closest_feature, on_feature, min_feature_dist)
    assert(closest_feature == "right_eye" and
           on_feature      == "right_eye" and
           min_feature_dist== 0)
    
    gaze_nose = Point(538, -149)
    closest_feature, on_feature, min_feature_dist = GetClosestFeature(gaze_nose, face_points)
    print(closest_feature, on_feature, min_feature_dist)
    assert(closest_feature == "nose" and
           on_feature      == "nose" and
           min_feature_dist== 0)
    
    gaze_mouth = Point(530, -170)
    closest_feature, on_feature, min_feature_dist = GetClosestFeature(gaze_mouth, face_points)
    print(closest_feature, on_feature, min_feature_dist)
    assert(closest_feature == "mouth" and
           on_feature      == "mouth" and
           min_feature_dist== 0)
    
    gaze_mouth = Point(460, -120)
    closest_feature, on_feature, min_feature_dist = GetClosestFeature(gaze_mouth, face_points)
    print(closest_feature, on_feature, min_feature_dist)
    assert(closest_feature == "left_eye" and
           on_feature      == "none")
    
    print("Passed Get Closest Feature")
    

def TestGazeOnFace():
    face_points = [Point(0,0), Point(0,1), Point(1,1), Point(1,0)]
    
    # Gaze not in square
    gaze_point = Point(2,2)
    assert(GazeOnFace(gaze_point, face_points) == False)

    # Gaze on boundary
    gaze_point = Point(0, 0.5)
    assert(GazeOnFace(gaze_point, face_points) == True)

    # Gaze inside square
    gaze_point = Point(0.5, 0.5)
    assert(GazeOnFace(gaze_point, face_points) == True)

    print("Passed Gaze on Face")

if __name__ == "__main__":
    TestGetClosestPoint()
    TestGazeOnFace()
    TestGetClosestFeature()